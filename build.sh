#!/bin/bash

npm update
npm install webextension-polyfill
npm install fomantic-ui
npm install jquery
npm install datatables.net
npm install codemirror-minified
npm install mermaid
npm install swagger-editor
npm install crypto-es

npm audit fix

#browser-polyfill
mkdir -p src/ptk/packages/browser-polyfill
cp ./node_modules/webextension-polyfill/dist/browser-polyfill.min.js src/ptk/packages/browser-polyfill
cp ./node_modules/webextension-polyfill/dist/browser-polyfill.min.js.map src/ptk/packages/browser-polyfill

#wappalyzer
mkdir -p src/ptk/packages/wappalyzer
# cp ./node_modules/wappalyzer-core/wappalyzer.js src/ptk/packages/wappalyzer
# sed -i '' "s/const Wappalyzer/export const Wappalyzer/" src/ptk/packages/wappalyzer/wappalyzer.js
curl  -o src/ptk/packages/wappalyzer/wappalyzer.js -L "https://raw.githubusercontent.com/DenisPodgurskii/wappalyzer/master/src/wappalyzer.js"


#jquery / jquery.dataTables
mkdir -p src/ptk/packages/jquery
cp ./node_modules/jquery/dist/jquery.min.js src/ptk/packages/jquery/
cp ./node_modules/jquery/dist/jquery.min.map src/ptk/packages/jquery/
cp ./node_modules/datatables.net/js/jquery.dataTables.min.js src/ptk/packages/jquery/


#semantic-ui / fomantic-ui
mkdir -p src/ptk/packages/semantic-ui
cp ./node_modules/fomantic-ui/dist/semantic.min.js src/ptk/packages/semantic-ui/
cp ./node_modules/fomantic-ui/dist/semantic.min.css src/ptk/packages/semantic-ui/
mkdir -p src/ptk/packages/semantic-ui/themes/default/
cp -r ./node_modules/fomantic-ui/dist/themes/default/ src/ptk/packages/semantic-ui/themes/default/

#codemirror
mkdir -p src/ptk/packages/codemirror
cp ./node_modules/codemirror-minified/lib/codemirror.js src/ptk/packages/codemirror/
cp ./node_modules/codemirror-minified/lib/codemirror.css src/ptk/packages/codemirror/
mkdir -p src/ptk/packages/codemirror/addon/fold/
cp -r ./node_modules/codemirror-minified/addon/fold/ src/ptk/packages/codemirror/addon/fold/
mkdir -p src/ptk/packages/codemirror/mode/xml/
cp -r ./node_modules/codemirror-minified/mode/xml/ src/ptk/packages/codemirror/mode/xml/
mkdir -p src/ptk/packages/codemirror/mode/javascript/
cp -r ./node_modules/codemirror-minified/mode/javascript/ src/ptk/packages/codemirror/mode/javascript/

#mermaid
mkdir -p src/ptk/packages/mermaid
cp ./node_modules/mermaid/dist/mermaid.min.js src/ptk/packages/mermaid/

#swagger-editor
mkdir -p src/ptk/packages/swagger-editor
cp ./node_modules/swagger-editor/dist/swagger-editor.css src/ptk/packages/swagger-editor/
cp ./node_modules/swagger-editor/dist/swagger-editor-bundle.js src/ptk/packages/swagger-editor/
curl  -o src/ptk/packages/swagger-editor/swagger-editor-standalone-preset.js -L "https://raw.githubusercontent.com/DenisPodgurskii/swagger-editor/master/dist/swagger-editor-standalone-preset.js"

#crypto-es
mkdir -p src/ptk/packages/crypto-es
cp -r ./node_modules/crypto-es/lib/ src/ptk/packages/crypto-es/

#retire
mkdir -p src/ptk/packages/retire
curl  -o src/ptk/packages/retire/retire.js -L "https://raw.githubusercontent.com/DenisPodgurskii/retire.js/master/node/lib/retire.js"
# echo 'export const retire = (function(){ ' | cat - src/ptk/packages/retire/retire.js  > temp && mv temp src/ptk/packages/retire/retire.js
# echo "return exports; })()" >> src/ptk/packages/retire/retire.js
curl  -o src/ptk/packages/retire/jsrepository.json -L "https://raw.githubusercontent.com/DenisPodgurskii/retire.js/master/repository/jsrepository.json"

#build tools
npm install archiver
npm install request

npm run build


